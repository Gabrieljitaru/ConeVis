<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ConeVis | Amministrazione</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>
    <section class="add-job">
        <h2>Aggiungi un'Offerta di Lavoro</h2>
        <form id="jobForm">
            <div>
                <label for="jobTitle">Titolo Offerta:</label>
                <input type="text" id="jobTitle" required>
            </div>
            <div>
                <label for="jobDescription">Descrizione:</label>
                <textarea id="jobDescription" required></textarea>
            </div>
            <div>
                <label for="jobLocation">Località:</label>
                <input type="text" id="jobLocation" required>
            </div>
            <button type="submit">Aggiungi Offerta</button>
        </form>
    </section>

    <h2>Gestione Contatti</h2>
        <div id="contacts-list">
            <!-- Contatti verranno caricati qui -->
        </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      document.getElementById('jobForm').addEventListener('submit', function (e) {
          e.preventDefault();

          const jobTitle = document.getElementById('jobTitle').value;
          const jobDescription = document.getElementById('jobDescription').value;
          const jobLocation = document.getElementById('jobLocation').value;

          const jobData = {
              titolo: jobTitle,
              descrizione: jobDescription,
              località: jobLocation,
              timestamp: Date.now()
          };

          fetch('https://conevishs-default-rtdb.firebaseio.com/offerte-di-lavoro.json', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(jobData)
          })
          .then(response => {
              if (response.ok) {
                  alert('L\'offerta di lavoro è stata aggiunta con successo!');
                  document.getElementById('jobForm').reset();
              } else {
                  throw new Error('Errore durante l\'invio dei dati.');
              }
          })
          .catch(error => {
              console.error("Errore durante l'invio dei dati:", error);
          });
      });
    </script>

<script>
    // Funzione per caricare i contatti da Firebase
    function loadContacts() {
        fetch('https://conevishs-default-rtdb.firebaseio.com/contatti.json')
            .then(response => response.json())
            .then(data => {
                const contactsList = document.getElementById('contacts-list');
                contactsList.innerHTML = ''; // Pulisce i contatti esistenti

                // Ordina i contatti dal più recente al più vecchio
                const sortedContacts = Object.entries(data || {}).sort((a, b) => b[1].timestamp - a[1].timestamp);

                // Itera sui contatti e li visualizza
                sortedContacts.forEach(([key, contact]) => {
                    const contactElement = document.createElement('div');
                    contactElement.className = 'contact-item';
                    contactElement.innerHTML = `
                        <h3>Nome: ${contact.nome}</h3>
                        <p><strong>Email:</strong> ${contact.email}</p>
                        <p><strong>Messaggio:</strong> ${contact.messaggio}</p>
                        <p><em>Inviato il: ${new Date(contact.timestamp).toLocaleString()}</em></p>
                        <hr>
                    `;
                    contactsList.appendChild(contactElement);
                });
            })
            .catch(error => {
                console.error('Errore durante il caricamento dei contatti:', error);
            });
    }

    // Carica i contatti al caricamento della pagina
    document.addEventListener('DOMContentLoaded', loadContacts);
</script>
</body>

</html>
